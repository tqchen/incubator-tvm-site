

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TensorFlow Frontend &mdash; tvm 0.7.dev1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/tvm-logo-square.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/tvm_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Index" href="../genindex.html" />
    <link rel="prev" title="Security" href="../dev/security.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/tvm-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.7.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vta/index.html">VTA: Deep Learning Accelerator Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Deploy and Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute to TVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../langref/index.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/python/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_links.html">Links to API References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Design and Developer Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">TensorFlow Frontend</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparing-a-model-for-inference">Preparing a Model for Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#remove-unneeded-nodes">Remove Unneeded Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#convert-none-dimensions-to-constants">Convert None Dimensions to Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export">Export</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#import-the-model">Import the Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#explicit-shape">Explicit Shape:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-layout">Data Layout</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-ops">Supported Ops</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tvm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>TensorFlow Frontend</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/frontend/tensorflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tensorflow-frontend">
<h1>TensorFlow Frontend<a class="headerlink" href="#tensorflow-frontend" title="Permalink to this headline">¶</a></h1>
<p>The TensorFlow frontend helps in importing TensorFlow models into TVM.</p>
<p>Supported versions:</p>
<ul class="simple">
<li><p>1.12 and below</p></li>
</ul>
<p>Tested models:</p>
<ul class="simple">
<li><p>Inception (V1/V2/V3/V4)</p></li>
<li><p>Resnet (All)</p></li>
<li><p>Mobilenet (V1/V2 All)</p></li>
<li><p>Vgg (16/19)</p></li>
<li><p>BERT (Base/3-layer)</p></li>
</ul>
<div class="section" id="preparing-a-model-for-inference">
<h2>Preparing a Model for Inference<a class="headerlink" href="#preparing-a-model-for-inference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="remove-unneeded-nodes">
<h3>Remove Unneeded Nodes<a class="headerlink" href="#remove-unneeded-nodes" title="Permalink to this headline">¶</a></h3>
<p>The export process will remove many nodes that are not needed for inference, but unfortunately will leave some remaining. The nodes that should be manually removed are:</p>
<ul class="simple">
<li><p>Dropout, including <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/nn/dropout">Dropout</a> and <a class="reference external" href="https://www.tensorflow.org/versions/r1.12/api_docs/python/tf/nn/rnn_cell/DropoutWrapper?hl=hr">DropoutWrapper</a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/debugging/Assert">Assert</a></p></li>
</ul>
</div>
<div class="section" id="convert-none-dimensions-to-constants">
<h3>Convert None Dimensions to Constants<a class="headerlink" href="#convert-none-dimensions-to-constants" title="Permalink to this headline">¶</a></h3>
<p>TVM has minimal support for dynamic tensor shapes. Dimensions that are <code class="docutils literal notranslate"><span class="pre">None</span></code> should be replaced with constants. For example, a model may accept an input with shape <code class="docutils literal notranslate"><span class="pre">(None,20)</span></code>. This should be converted to a shape like <code class="docutils literal notranslate"><span class="pre">(1,20)</span></code>. The model should be modified accordingly to ensure that these shapes match throughout the graph.</p>
</div>
<div class="section" id="export">
<h3>Export<a class="headerlink" href="#export" title="Permalink to this headline">¶</a></h3>
<p>TensorFlow frontend expects a frozen protobuf (.pb) or saved model as input. It currently does not support checkpoint (.ckpt). The graphdef needed by the TensorFlow frontend can be extracted from the active session, or by using the <a class="reference external" href="https://github.com/apache/incubator-tvm/blob/master/python/tvm/relay/frontend/tensorflow_parser.py">TFParser</a> helper class.</p>
<p>The model should be exported with a number of transformations to prepare the model for inference. It is also important to set <code class="docutils literal notranslate"><span class="pre">`add_shapes=True`</span></code>, as this will embed the output shapes of each node into the graph. Here is one function to export a model as a protobuf given a session:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.tools.graph_transforms</span> <span class="kn">import</span> <span class="n">TransformGraph</span>

<span class="k">def</span> <span class="nf">export_pb</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">gfile</span><span class="o">.</span><span class="n">GFile</span><span class="p">(</span><span class="s2">&quot;myexportedmodel.pb&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;myinput1&quot;</span><span class="p">,</span> <span class="s2">&quot;myinput2&quot;</span><span class="p">]</span> <span class="c1"># replace with your input names</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;myoutput1&quot;</span><span class="p">]</span> <span class="c1"># replace with your output names</span>
        <span class="n">graph_def</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">as_graph_def</span><span class="p">(</span><span class="n">add_shapes</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">graph_def</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">convert_variables_to_constants</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">graph_def</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="n">graph_def</span> <span class="o">=</span> <span class="n">TransformGraph</span><span class="p">(</span>
            <span class="n">graph_def</span><span class="p">,</span>
            <span class="n">inputs</span><span class="p">,</span>
            <span class="n">outputs</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;remove_nodes(op=Identity, op=CheckNumerics, op=StopGradient)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sort_by_execution_order&quot;</span><span class="p">,</span> <span class="c1"># sort by execution order after each transform to ensure correct node ordering</span>
                <span class="s2">&quot;remove_device&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sort_by_execution_order&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fold_batch_norms&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sort_by_execution_order&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fold_old_batch_norms&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sort_by_execution_order&quot;</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">graph_def</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
</pre></div>
</div>
<p>Another method is to <a class="reference external" href="https://github.com/tensorflow/models/tree/master/research/slim#exporting-the-inference-graph">export and freeze the graph</a>.</p>
</div>
</div>
<div class="section" id="import-the-model">
<h2>Import the Model<a class="headerlink" href="#import-the-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="explicit-shape">
<h3>Explicit Shape:<a class="headerlink" href="#explicit-shape" title="Permalink to this headline">¶</a></h3>
<p>To ensure shapes can be known throughout the entire graph, pass the <code class="docutils literal notranslate"><span class="pre">`shape`</span></code> argument to <code class="docutils literal notranslate"><span class="pre">`from_tensorflow`</span></code>. This dictionary maps input names to input shapes. Please refer to these <a class="reference external" href="https://github.com/apache/incubator-tvm/blob/master/tests/python/frontend/tensorflow/test_forward.py#L36">test cases</a> for examples.</p>
</div>
<div class="section" id="data-layout">
<h3>Data Layout<a class="headerlink" href="#data-layout" title="Permalink to this headline">¶</a></h3>
<p>Most TensorFlow models are released with NHWC layout. NCHW layout often provides better performance, especially on GPU. The TensorFlow frontend can automatically convert the model’s data layout by passing the argument <code class="docutils literal notranslate"><span class="pre">`layout='NCHW'`</span></code> to <code class="docutils literal notranslate"><span class="pre">`from_tensorflow`</span></code>.</p>
</div>
</div>
<div class="section" id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use static tensor shapes instead of dynamic shapes (remove <code class="docutils literal notranslate"><span class="pre">`None`</span></code> dimensions).</p></li>
<li><p>Use static RNN instead of dynamic RNN, as <code class="docutils literal notranslate"><span class="pre">`TensorArray`</span></code> isn’t supported yet.</p></li>
</ul>
</div>
<div class="section" id="supported-ops">
<h2>Supported Ops<a class="headerlink" href="#supported-ops" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Abs</p></li>
<li><p>Add</p></li>
<li><p>AddN</p></li>
<li><p>All</p></li>
<li><p>Any</p></li>
<li><p>ArgMax</p></li>
<li><p>ArgMin</p></li>
<li><p>AvgPool</p></li>
<li><p>BatchMatMul</p></li>
<li><p>BatchMatMulV2</p></li>
<li><p>BatchNormWithGlobalNormalization</p></li>
<li><p>BatchToSpaceND</p></li>
<li><p>BiasAdd</p></li>
<li><p>BroadcastTo</p></li>
<li><p>Cast</p></li>
<li><p>Ceil</p></li>
<li><p>CheckNumerics</p></li>
<li><p>ClipByValue</p></li>
<li><p>Concat</p></li>
<li><p>ConcatV2</p></li>
<li><p>Conv2D</p></li>
<li><p>Cos</p></li>
<li><p>Tan</p></li>
<li><p>CropAndResize</p></li>
<li><p>DecodeJpeg</p></li>
<li><p>DepthwiseConv2dNative</p></li>
<li><p>DepthToSpace</p></li>
<li><p>Dilation2D</p></li>
<li><p>Equal</p></li>
<li><p>Elu</p></li>
<li><p>Enter</p></li>
<li><p>Erf</p></li>
<li><p>Exit</p></li>
<li><p>Exp</p></li>
<li><p>ExpandDims</p></li>
<li><p>Fill</p></li>
<li><p>Floor</p></li>
<li><p>FloorDiv</p></li>
<li><p>FloorMod</p></li>
<li><p>FusedBatchNorm</p></li>
<li><p>FusedBatchNormV2</p></li>
<li><p>Gather</p></li>
<li><p>GatherNd</p></li>
<li><p>GatherV2</p></li>
<li><p>Greater</p></li>
<li><p>GreaterEqual</p></li>
<li><p>Identity</p></li>
<li><p>IsFinite</p></li>
<li><p>IsInf</p></li>
<li><p>LeakyRelu</p></li>
<li><p>LeftShift</p></li>
<li><p>Less</p></li>
<li><p>LessEqual</p></li>
<li><p>Log</p></li>
<li><p>Log1p</p></li>
<li><p>LoopCond</p></li>
<li><p>LogicalAnd</p></li>
<li><p>LogicalOr</p></li>
<li><p>LogicalNot</p></li>
<li><p>LogSoftmax</p></li>
<li><p>LRN</p></li>
<li><p>LSTMBlockCell</p></li>
<li><p>MatMul</p></li>
<li><p>Max</p></li>
<li><p>MaxPool</p></li>
<li><p>Maximum</p></li>
<li><p>Mean</p></li>
<li><p>Merge</p></li>
<li><p>Min</p></li>
<li><p>Minimum</p></li>
<li><p>MirrorPad</p></li>
<li><p>Mod</p></li>
<li><p>Mul</p></li>
<li><p>Neg</p></li>
<li><p>NextIteration</p></li>
<li><p>NotEqual</p></li>
<li><p>OneHot</p></li>
<li><p>Pack</p></li>
<li><p>Pad</p></li>
<li><p>PadV2</p></li>
<li><p>Pow</p></li>
<li><p>Prod</p></li>
<li><p>Range</p></li>
<li><p>Rank</p></li>
<li><p>RealDiv</p></li>
<li><p>Relu</p></li>
<li><p>Relu6</p></li>
<li><p>Reshape</p></li>
<li><p>ResizeBilinear</p></li>
<li><p>ResizeBicubic</p></li>
<li><p>ResizeNearestNeighbor</p></li>
<li><p>ReverseV2</p></li>
<li><p>RightShift</p></li>
<li><p>Round</p></li>
<li><p>Rsqrt</p></li>
<li><p>Select</p></li>
<li><p>Selu</p></li>
<li><p>Shape</p></li>
<li><p>Sigmoid</p></li>
<li><p>Sign</p></li>
<li><p>Sin</p></li>
<li><p>Size</p></li>
<li><p>Slice</p></li>
<li><p>Softmax</p></li>
<li><p>Softplus</p></li>
<li><p>SpaceToBatchND</p></li>
<li><p>SpaceToDepth,</p></li>
<li><p>Split</p></li>
<li><p>SplitV</p></li>
<li><p>Sqrt</p></li>
<li><p>Square</p></li>
<li><p>SquareDifference</p></li>
<li><p>Squeeze</p></li>
<li><p>StridedSlice</p></li>
<li><p>Sub</p></li>
<li><p>Sum</p></li>
<li><p>Switch</p></li>
<li><p>Tanh</p></li>
<li><p>TensorArrayV3</p></li>
<li><p>TensorArrayScatterV3</p></li>
<li><p>TensorArrayGatherV3</p></li>
<li><p>TensorArraySizeV3</p></li>
<li><p>TensorArrayWriteV3</p></li>
<li><p>TensorArrayReadV3</p></li>
<li><p>TensorArraySplitV3</p></li>
<li><p>TensorArrayConcatV3</p></li>
<li><p>Tile</p></li>
<li><p>TopKV2</p></li>
<li><p>Transpose</p></li>
<li><p>TruncateMod</p></li>
<li><p>Unpack</p></li>
<li><p>UnravelIndex</p></li>
<li><p>Where</p></li>
<li><p>ZerosLike</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../genindex.html" class="btn btn-neutral float-right" title="Index" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../dev/security.html" class="btn btn-neutral float-left" title="Security" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Apache Software Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75982049-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>